<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Investment Planner (Gold / Stock / MF)</title>
<meta name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
    }

    h1 {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .subtitle {
      font-size: 0.9rem;
      color: #9ca3af;
      text-align: center;
      margin-bottom: 1rem;
    }

    .card {
      background: #020617;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      border: 1px solid #1f2937;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .tab-btn {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .tab-btn.active {
      background: linear-gradient(135deg,#38bdf8,#22c55e);
      color: #020617;
      border-color: transparent;
      font-weight: 600;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 640px) {
      .form-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.85rem;
      color: #d1d5db;
    }

    input, select {
      border-radius: 8px;
      padding: 8px 10px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 16px; /* avoid iOS zoom on focus */
      width: 100%;
    }

    input::placeholder { color: #6b7280; }

    input:focus, select:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }

    .field-inline {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .field-inline span {
      font-size: 0.85rem;
      color: #9ca3af;
      white-space: nowrap;
    }

    .actions {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      background: linear-gradient(135deg,#22c55e,#16a34a);
      color: #022c22;
    }

    .btn-secondary {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #4b5563;
    }

    .btn-primary:active,
    .btn-secondary:active {
      transform: translateY(1px);
    }

    .results {
      margin-top: 16px;
      background: #020617;
      border-radius: 12px;
      padding: 12px;
      border: 1px solid #1f2937;
    }

    .summary-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 0.85rem;
      margin-bottom: 8px;
    }

    .summary-item {
      flex: 1 1 120px;
      background: #020617;
      border-radius: 8px;
      padding: 8px;
      border: 1px solid #111827;
    }

    .summary-label {
      color: #9ca3af;
      font-size: 0.75rem;
      margin-bottom: 2px;
    }

    .summary-value {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .table-wrapper {
      overflow-x: auto;
      margin-top: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      min-width: 620px;
    }

    thead { background: #020617; }

    th, td {
      text-align: right;
      padding: 6px 8px;
      border-bottom: 1px solid #1f2937;
      white-space: nowrap;
    }

    th:first-child, td:first-child { text-align: left; }

    th {
      font-weight: 600;
      color: #9ca3af;
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
    }

    tbody tr:nth-child(even) { background: #020617; }

    /* Highlight end of tenure row */
    .tenure-row {
      background: #111827 !important;
      font-weight: 600;
    }

    .tenure-row td:first-child {
      border-left: 3px solid #22c55e;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: #0f172a;
      color: #9ca3af;
      border: 1px solid #1f2937;
    }

    .note {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-top: 6px;
    }

    .error {
      margin-top: 8px;
      color: #fecaca;
      font-size: 0.8rem;
    }

    /* Print styles */
    @media print {
      /* Force white background & black text everywhere */
      *, *::before, *::after {
        background: #ffffff !important;
        color: #000000 !important;
        box-shadow: none !important;
      }

      body {
        margin: 0;
        padding: 0;
      }

      .page { padding: 0; }

      .card {
        border: none !important;
      }

      .actions,
      button {
        display: none !important;
      }

      .table-wrapper {
        overflow: visible !important;
      }

      table {
        min-width: 100% !important;
        font-size: 0.75rem;
      }

      th, td {
        white-space: normal !important;
        border-bottom: 1px solid #dddddd !important;
      }

      th {
        position: static !important;
      }

      .tenure-row td:first-child {
        border-left: 3px solid #22c55e !important;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <h1>Investment Planner</h1>
  <div class="subtitle">
    Gold, Stocks &amp; Mutual Funds – step-up SIP with inflation-adjusted projections.
  </div>

  <div class="card" id="plannerCard">
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-asset="gold">Gold</button>
      <button class="tab-btn" data-asset="stock">Stock</button>
      <button class="tab-btn" data-asset="mf">Mutual Fund</button>
    </div>

    <div class="form-grid">
      <!-- Rate field (hidden for MF) -->
      <div class="field" id="goldRateField">
        <label for="goldRate" id="rateLabel">Today's gold rate (₹ per gram)</label>
        <input type="number" id="goldRate" placeholder="e.g. 7500" step="0.01" min="0">
      </div>

      <!-- Frequency -->
      <div class="field">
        <label for="frequency">Investment frequency</label>
        <select id="frequency">
          <option value="yearly">Yearly</option>
          <option value="monthly">Monthly</option>
        </select>
      </div>

      <!-- Planned investment -->
      <div class="field">
        <label for="plannedInvestment">Planned investment amount (₹ per period)</label>
        <input type="number" id="plannedInvestment" placeholder="e.g. 100000" step="0.01" min="0">
      </div>

      <!-- Step-up % -->
      <div class="field">
        <label for="stepUp">
          Step-up in investment (% per year)
        </label>
        <div class="field-inline">
          <input type="number" id="stepUp" placeholder="e.g. 5" step="0.01" min="0">
          <span class="badge">applied once every year</span>
        </div>
      </div>

      <!-- Growth rate -->
      <div class="field">
        <label for="growthRate" id="growthLabel">Estimated gold price growth (% per year)</label>
        <input type="number" id="growthRate" placeholder="e.g. 10" step="0.01">
      </div>

      <!-- Inflation rate -->
      <div class="field">
        <label for="inflationRate">Expected inflation (% per year)</label>
        <input type="number" id="inflationRate" placeholder="e.g. 5" step="0.01">
      </div>

      <!-- Tenure -->
      <div class="field">
        <label for="tenureValue" id="tenureLabel">Tenure of investment (years)</label>
        <input type="number" id="tenureValue" placeholder="e.g. 10" min="1" step="1">
      </div>

      <!-- Help text -->
      <div class="field">
        <span class="note">
          Frequency decides tenure unit: yearly → years, monthly → months.
        </span>
      </div>
    </div>

    <div class="actions">
      <button class="btn-primary" onclick="calculatePlan()">
        ▶ Calculate
      </button>
      <button class="btn-secondary" id="printBtn" style="display:none;" onclick="window.print()">
        ⬇ Download / Print PDF
      </button>
    </div>

    <div id="errorBox" class="error" style="display:none;"></div>

    <div id="results" class="results" style="display:none;">
      <div class="summary-row">
        <div class="summary-item">
          <div class="summary-label">Total invested over tenure</div>
          <div class="summary-value" id="summaryInvested">₹0</div>
        </div>
        <div class="summary-item">
          <div class="summary-label" id="summaryQtyLabel">Gold accumulated by end of tenure</div>
          <div class="summary-value" id="summaryQty">0</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Value at end of tenure (nominal)</div>
          <div class="summary-value" id="summaryNominal">₹0</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Real value in today's ₹ (inflation-adjusted)</div>
          <div class="summary-value" id="summaryReal">₹0</div>
        </div>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
          <tr>
            <th>Time</th>
            <th id="qtyHeader">Gold accumulated (g)</th>
            <th>Total invested (₹)</th>
            <th>Nominal value (₹ at that time)</th>
            <th>Real value (₹ in today's money)</th>
          </tr>
          </thead>
          <tbody id="resultsTableBody">
          <!-- Rows injected by JS -->
          </tbody>
        </table>
      </div>

      <div class="note">
        Growth is interpreted as % per year (for yearly SIP) or % per month (for monthly SIP).
        Inflation is % per year. Actual returns will differ.
      </div>
    </div>

  </div>
</div>

<script>
  const frequencySelect = document.getElementById('frequency');
  const tenureLabel = document.getElementById('tenureLabel');
  const errorBox = document.getElementById('errorBox');
  const resultsContainer = document.getElementById('results');
  const tableBody = document.getElementById('resultsTableBody');
  const printBtn = document.getElementById('printBtn');

  const goldRateField = document.getElementById('goldRateField');
  const rateLabelEl = document.getElementById('rateLabel');
  const growthLabelEl = document.getElementById('growthLabel');
  const qtyHeaderEl = document.getElementById('qtyHeader');
  const summaryQtyLabelEl = document.getElementById('summaryQtyLabel');
  const summaryQtyValueEl = document.getElementById('summaryQty');

  const tabs = document.querySelectorAll('.tab-btn');

  let currentAsset = 'gold';
  let qtySuffix = ' g';

  const tabState = { gold: {}, stock: {}, mf: {} };

  function readFormState() {
    return {
      goldRate: document.getElementById('goldRate').value,
      frequency: frequencySelect.value,
      plannedInvestment: document.getElementById('plannedInvestment').value,
      stepUp: document.getElementById('stepUp').value,
      growthRate: document.getElementById('growthRate').value,
      inflationRate: document.getElementById('inflationRate').value,
      tenureValue: document.getElementById('tenureValue').value
    };
  }

  function applyFormState(state) {
    if (!state) return;
    document.getElementById('goldRate').value = state.goldRate ?? '';
    frequencySelect.value = state.frequency ?? 'yearly';
    document.getElementById('plannedInvestment').value = state.plannedInvestment ?? '';
    document.getElementById('stepUp').value = state.stepUp ?? '';
    document.getElementById('growthRate').value = state.growthRate ?? '';
    document.getElementById('inflationRate').value = state.inflationRate ?? '';
    document.getElementById('tenureValue').value = state.tenureValue ?? '';
    updateTenureLabel();
    updateGrowthLabel();
  }

  function updateTenureLabel() {
    const freq = frequencySelect.value;
    tenureLabel.textContent = freq === 'yearly'
      ? 'Tenure of investment (years)'
      : 'Tenure of investment (months)';
  }

  function updateGrowthLabel() {
    const freq = frequencySelect.value;
    let base;
    if (currentAsset === 'gold') {
      base = 'Estimated gold price growth';
    } else if (currentAsset === 'stock') {
      base = 'Estimated stock price growth';
    } else {
      base = 'Estimated NAV growth';
    }
    const suffix = freq === 'yearly' ? ' (% per year)' : ' (% per month)';
    growthLabelEl.textContent = base + suffix;
  }

  function applyAssetConfig() {
    if (currentAsset === 'gold') {
      goldRateField.style.display = '';
      rateLabelEl.textContent = "Today's gold rate (₹ per gram)";
      qtySuffix = ' g';
      qtyHeaderEl.textContent = 'Gold accumulated (g)';
      summaryQtyLabelEl.textContent = 'Gold accumulated by end of tenure';
    } else if (currentAsset === 'stock') {
      goldRateField.style.display = '';
      rateLabelEl.textContent = "Today's stock price (₹ per share)";
      qtySuffix = ' units';
      qtyHeaderEl.textContent = 'Shares accumulated (units)';
      summaryQtyLabelEl.textContent = 'Shares accumulated by end of tenure';
    } else if (currentAsset === 'mf') {
      goldRateField.style.display = 'none';
      qtySuffix = ' units';
      qtyHeaderEl.textContent = 'Units accumulated';
      summaryQtyLabelEl.textContent = 'Units accumulated by end of tenure';
    }
    updateGrowthLabel();
  }

  // Tab switching
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const asset = tab.getAttribute('data-asset');
      if (asset === currentAsset) return;

      tabState[currentAsset] = readFormState();

      currentAsset = asset;
      tabs.forEach(t => {
        t.classList.toggle('active', t.getAttribute('data-asset') === asset);
      });

      applyAssetConfig();
      applyFormState(tabState[asset] || {});

      resultsContainer.style.display = 'none';
      tableBody.innerHTML = '';
      printBtn.style.display = 'none';
      errorBox.style.display = 'none';
    });
  });

  // Frequency change: tenure label + growth label
  frequencySelect.addEventListener('change', () => {
    updateTenureLabel();
    updateGrowthLabel();
  });

  // initial config
  applyAssetConfig();
  updateTenureLabel();

  function formatReadableIndian(value) {
    if (!isFinite(value)) return '0';
    const abs = Math.abs(value);
    let short = value;
    let suffix = '';

    if (abs >= 1e7) {
      short = value / 1e7;
      suffix = ' Cr';
    } else if (abs >= 1e5) {
      short = value / 1e5;
      suffix = ' Lakh';
    } else if (abs >= 1e3) {
      short = value / 1e3;
      suffix = 'K';
    } else {
      short = value;
    }

    return short.toFixed(2) + suffix;
  }

  function formatCurrency(value) {
    if (!isFinite(value)) return '₹0';
    const full = value.toLocaleString('en-IN', {
      maximumFractionDigits: 2,
      minimumFractionDigits: 2
    });
    const short = formatReadableIndian(value);
    return `₹${full} (${short})`;
  }

  function formatNumber(value, digits = 2) {
    if (!isFinite(value)) return '0';
    return value.toLocaleString('en-IN', {
      maximumFractionDigits: digits,
      minimumFractionDigits: digits
    });
  }

  function calculatePlan() {
    errorBox.style.display = 'none';
    errorBox.textContent = '';
    resultsContainer.style.display = 'none';
    tableBody.innerHTML = '';
    printBtn.style.display = 'none';

    const goldRateRaw = parseFloat(document.getElementById('goldRate').value);
    const frequency = frequencySelect.value;
    const plannedInvestment = parseFloat(document.getElementById('plannedInvestment').value);
    const stepUpPercent = parseFloat(document.getElementById('stepUp').value) || 0;
    const growthRatePercent = parseFloat(document.getElementById('growthRate').value);
    const inflationRatePercent = parseFloat(document.getElementById('inflationRate').value);
    const tenureValue = parseInt(document.getElementById('tenureValue').value, 10);

    if ((currentAsset !== 'mf' && (!goldRateRaw || goldRateRaw <= 0)) ||
        !plannedInvestment || plannedInvestment <= 0 ||
        !tenureValue || tenureValue <= 0 ||
        isNaN(growthRatePercent) ||
        isNaN(inflationRatePercent)) {
      errorBox.textContent = 'Please fill all required fields with valid numbers (price/NAV if needed, investment amount, tenure, growth & inflation).';
      errorBox.style.display = 'block';
      return;
    }

    let basePrice;
    if (currentAsset === 'mf') {
      basePrice = 1;
    } else {
      basePrice = goldRateRaw;
    }

    const stepUp = stepUpPercent / 100;
    const inflAnnual = inflationRatePercent / 100;

    const growthInput = growthRatePercent / 100;
    let growthPerPeriod, growthAnnual;

    if (frequency === 'yearly') {
      growthPerPeriod = growthInput;          // per year
      growthAnnual = growthInput;
    } else {
      growthPerPeriod = growthInput;          // per month
      growthAnnual = Math.pow(1 + growthInput, 12) - 1;
    }

    let tenureYears, periods, periodsPerYear;
    if (frequency === 'yearly') {
      tenureYears = tenureValue;
      periodsPerYear = 1;
      periods = tenureValue;
    } else {
      tenureYears = tenureValue / 12;
      periodsPerYear = 12;
      periods = tenureValue;
    }

    if (periods <= 0) {
      errorBox.textContent = 'Tenure is too short to simulate. Increase years/months.';
      errorBox.style.display = 'block';
      return;
    }

    let totalInvested = 0;
    let totalUnits = 0;

    for (let i = 0; i < periods; i++) {
      const yearIndex = (frequency === 'yearly')
        ? i
        : Math.floor(i / 12);

      const contributionThisPeriod = plannedInvestment * Math.pow(1 + stepUp, yearIndex);
      const priceThisPeriod = basePrice * Math.pow(1 + growthPerPeriod, i);
      const unitsThisPeriod = contributionThisPeriod / priceThisPeriod;

      totalInvested += contributionThisPeriod;
      totalUnits += unitsThisPeriod;
    }

    const priceAtEndTenure = basePrice * Math.pow(1 + growthAnnual, tenureYears);
    const nominalEndValue = totalUnits * priceAtEndTenure;
    const realEndValue = nominalEndValue / Math.pow(1 + inflAnnual, tenureYears);

    document.getElementById('summaryInvested').textContent = formatCurrency(totalInvested);
    summaryQtyValueEl.textContent = formatNumber(totalUnits, 3) + qtySuffix;
    document.getElementById('summaryNominal').textContent = formatCurrency(nominalEndValue);
    document.getElementById('summaryReal').textContent = formatCurrency(realEndValue);

    function computeTotalsUpToYears(hYears) {
      let invested = 0;
      let units = 0;
      for (let i = 0; i < periods; i++) {
        const tYears = (frequency === 'yearly') ? i : i / 12;
        if (tYears >= hYears - 1e-9) break;

        const yearIndex = (frequency === 'yearly')
          ? i
          : Math.floor(i / 12);

        const contributionThisPeriod = plannedInvestment * Math.pow(1 + stepUp, yearIndex);
        const priceThisPeriod = basePrice * Math.pow(1 + growthPerPeriod, i);
        const unitsThisPeriod = contributionThisPeriod / priceThisPeriod;

        invested += contributionThisPeriod;
        units += unitsThisPeriod;
      }
      return { invested, units };
    }

    for (let y = 5; y < tenureYears - 1e-9; y += 5) {
      const { invested, units } = computeTotalsUpToYears(y);
      const priceAtHorizon = basePrice * Math.pow(1 + growthAnnual, y);
      const nominalValue = units * priceAtHorizon;
      const realValue = nominalValue / Math.pow(1 + inflAnnual, y);

      const tr = document.createElement('tr');
      const appendCell = (text) => {
        const td = document.createElement('td');
        td.textContent = text;
        tr.appendChild(td);
      };

      appendCell(`After ${y} years`);
      appendCell(formatNumber(units, 3) + qtySuffix);
      appendCell(formatCurrency(invested));
      appendCell(formatCurrency(nominalValue));
      appendCell(formatCurrency(realValue));

      tableBody.appendChild(tr);
    }

    const horizons = [
      { label: `End of tenure (${formatNumber(tenureYears, 1)} yrs)`, extraYears: 0 },
      { label: `Tenure + 5 years`, extraYears: 5 },
      { label: `Tenure + 15 years`, extraYears: 15 },
      { label: `Tenure + 20 years`, extraYears: 20 },
      { label: `Tenure + 25 years`, extraYears: 25 }
    ];

    horizons.forEach(h => {
      const totalYearsFromToday = tenureYears + h.extraYears;

      const priceAtHorizon = basePrice * Math.pow(1 + growthAnnual, totalYearsFromToday);
      const nominalValue = totalUnits * priceAtHorizon;
      const realValue = nominalValue / Math.pow(1 + inflAnnual, totalYearsFromToday);

      const tr = document.createElement('tr');
      if (h.extraYears === 0) tr.classList.add('tenure-row');

      const appendCell = (text) => {
        const td = document.createElement('td');
        td.textContent = text;
        tr.appendChild(td);
      };

      appendCell(h.label);
      appendCell(formatNumber(totalUnits, 3) + qtySuffix);
      appendCell(formatCurrency(totalInvested));
      appendCell(formatCurrency(nominalValue));
      appendCell(formatCurrency(realValue));

      tableBody.appendChild(tr);
    });

    resultsContainer.style.display = 'block';
    printBtn.style.display = 'inline-flex';
  }
</script>
</body>
</html>
